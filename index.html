<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>بطاقة دعوة زواج</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Amiri&display=swap" rel="stylesheet">

  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    body { background:#f0f0f0; font-family:'Cairo', sans-serif; padding:20px; }
    .controls { max-width:480px; margin:auto; }

    .card-preview {
      width:480px; height:760px;
      margin:auto;
      background:#222; background-size:cover; background-position:center;
      border-radius:12px; color:#e6d3b8;
      box-shadow:0 8px 25px rgba(0,0,0,0.4);
      position:relative;
      overflow:hidden;
    }

    .center-block { 
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
      text-align:center; width:90%;
    }

    .inv-title { font-size:18px; }
    .inv-name { font-family:'Amiri', serif; font-size:38px; font-weight:700; margin:8px 0; }
    .inv-body { font-size:17px; margin-top:10px; }
    .inv-groom { font-family:'Amiri', serif; font-size:34px; margin-top:4px; }
    .inv-meta { margin-top:20px; font-size:14px; }
    .ornament { position:absolute; width:100px; height:100px; opacity:0.8; stroke:#c9b08a; fill:none; }
    .top-left{top:10px;left:10px;} .top-right{top:10px;right:10px;transform:rotate(90deg);}
    .bottom-left{bottom:10px;left:10px;transform:rotate(-90deg);} .bottom-right{bottom:10px;right:10px;transform:rotate(180deg);}
  </style>
</head>
<body>

<div class="container">
  <h3 class="text-center mb-3">مولد بطاقة دعوة زواج</h3>

  <div class="row gx-3">
    <div class="col-md-5">
      <div class="card p-3 controls">
        <div class="mb-2">
          <label class="form-label small">النص الأعلى</label>
          <input id="inputTitle" class="form-control" value="يتشرف">
        </div>
        <div class="mb-2">
          <label class="form-label small">اسم الداعي</label>
          <input id="inputName" class="form-control" value="مطلو بن نايف الشقور">
        </div>
        <div class="mb-2">
          <label class="form-label small">اسم العريس (الشاب)</label>
          <input id="inputGroom" class="form-control" value="عبدالله">
        </div>
        <div class="mb-2">
          <label class="form-label small">التاريخ</label>
          <input id="inputDate" class="form-control" value="١٤٤٦/٥/١٢ هـ - ١٤/١١/٢٠٢٤ م">
        </div>
        <div class="mb-2">
          <label class="form-label small">اليوم / الوقت</label>
          <input id="inputTime" class="form-control" value="مساء يوم الخميس">
        </div>
        <div class="mb-2">
          <label class="form-label small">المكان</label>
          <input id="inputPlace" class="form-control" value="قاعة الفخامة – المجمعة">
        </div>
        <div class="mb-2">
          <label class="form-label small">لون الخلفية</label>
          <input id="bgColor" type="color" class="form-control form-control-color" value="#222222">
        </div>
        <div class="mb-2">
          <label class="form-label small">خلفية (اختيارية)</label>
          <input id="bgUpload" type="file" accept="image/*" class="form-control form-control-sm">
        </div>

        <button id="downloadBtn" class="btn btn-primary mt-3">تحميل كصورة PNG</button>
      </div>
    </div>

    <div class="col-md-7 d-flex align-items-center justify-content-center">
      <div id="preview" class="card-preview">
        <svg class="ornament top-left" viewBox="0 0 100 100"><path d="M10 10 C40 0 60 0 90 10 L90 90 C60 100 40 100 10 90 Z"/></svg>
        <svg class="ornament top-right" viewBox="0 0 100 100"><path d="M10 10 C40 0 60 0 90 10 L90 90 C60 100 40 100 10 90 Z"/></svg>
        <svg class="ornament bottom-left" viewBox="0 0 100 100"><path d="M10 10 C40 0 60 0 90 10 L90 90 C60 100 40 100 10 90 Z"/></svg>
        <svg class="ornament bottom-right" viewBox="0 0 100 100"><path d="M10 10 C40 0 60 0 90 10 L90 90 C60 100 40 100 10 90 Z"/></svg>

        <div class="center-block">
          <div id="titleText" class="inv-title">يتشرف</div>
          <div id="nameText" class="inv-name">مطلو بن نايف الشقور</div>
          <div id="bodyText" class="inv-body">بدعوتكم لحضور حفل زواج الشاب</div>
          <div id="groomText" class="inv-groom">عبدالله</div>
          <div id="timeText" class="inv-meta">مساء يوم الخميس</div>
          <div id="placeText" class="inv-meta">قاعة الفخامة – المجمعة</div>
          <div id="dateText" class="inv-meta">١٤٤٦/٥/١٢ هـ - ١٤/١١/٢٠٢٤ م</div>
          <div style="margin-top:25px; font-size:13px;">شاكرين لكم تلبية الدعوة</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const inputs = {
  title: document.getElementById('inputTitle'),
  name: document.getElementById('inputName'),
  groom: document.getElementById('inputGroom'),
  date: document.getElementById('inputDate'),
  time: document.getElementById('inputTime'),
  place: document.getElementById('inputPlace'),
  bgColor: document.getElementById('bgColor'),
  bgUpload: document.getElementById('bgUpload'),
};
const texts = {
  title: document.getElementById('titleText'),
  name: document.getElementById('nameText'),
  groom: document.getElementById('groomText'),
  date: document.getElementById('dateText'),
  time: document.getElementById('timeText'),
  place: document.getElementById('placeText'),
};
const preview = document.getElementById('preview');

// تحديث النصوص مباشرة
Object.keys(inputs).forEach(k=>{
  if(['bgColor','bgUpload'].includes(k)) return;
  inputs[k].addEventListener('input', updatePreview);
});

function updatePreview(){
  texts.title.textContent = inputs.title.value;
  texts.name.textContent = inputs.name.value;
  texts.groom.textContent = inputs.groom.value;
  texts.date.textContent = inputs.date.value;
  texts.time.textContent = inputs.time.value;
  texts.place.textContent = inputs.place.value;
}

// تغيير الخلفية
inputs.bgColor.addEventListener('input', ()=>{
  preview.style.backgroundColor = inputs.bgColor.value;
  preview.style.backgroundImage = '';
});
inputs.bgUpload.addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ev => {
    preview.style.backgroundImage = `url(${ev.target.result})`;
  };
  r.readAsDataURL(f);
});

// تحميل الصورة
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  // تأكد من تحميل الخطوط قبل الالتقاط
  document.fonts.ready.then(()=>{
    html2canvas(preview, {
      scale:2.5,
      useCORS:true,
      backgroundColor:null
    }).then(canvas=>{
      canvas.toBlob(blob=>{
        const a=document.createElement('a');
        a.download='دعوة_زواج.png';
        a.href=URL.createObjectURL(blob);
        a.click();
      });
    });
  });
});

// تهيئة أولية
preview.style.backgroundColor = inputs.bgColor.value;
updatePreview();
</script>
</body>
</html>